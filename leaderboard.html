<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satoshi's Secret - Leaderboard</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #0a0a1a;
            background: #0a0a1a;
            color: white;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background-image: url('pixelstars.gif');
            background-repeat: repeat;
            background-size: 256px 256px;
            z-index: -1;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .title {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .title-image {
            max-width: 600px;
            width: 90%;
            height: auto;
            image-rendering: pixelated;
            -webkit-image-rendering: pixelated;
            -moz-image-rendering: crisp-edges;
        }

        .search-container {
            margin-bottom: 1rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem;
            background: rgba(13, 17, 23, 0.5);
            border: 2px solid #4FB4FF;
            border-radius: 8px;
            color: white;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            outline: none;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }

        .search-input:focus {
            box-shadow: 0 0 20px rgba(79, 180, 255, 0.3);
        }

        .search-input::placeholder {
            color: rgba(79, 180, 255, 0.5);
        }

        .scoreboard {
            background: rgba(13, 17, 23, 0.5);
            border: 2px solid #4FB4FF;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 0 20px rgba(79, 180, 255, 0.2);
            max-height: 530px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        .scoreboard::-webkit-scrollbar {
            width: 13px;
        }

        .scoreboard::-webkit-scrollbar-track {
            background: rgba(13, 17, 23, 0.5);
            border-radius: 0 8px 8px 0;
        }

        .scoreboard::-webkit-scrollbar-thumb {
            background: #4FB4FF;
            border-radius: 5px;
            border: 3px solid rgba(13, 17, 23, 0.5);
        }

        .scoreboard::-webkit-scrollbar-thumb:hover {
            background: #6B8CFF;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            color: #4FB4FF;
            text-align: left;
            padding: 1rem;
            border-bottom: 2px solid #4FB4FF;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid rgba(79, 180, 255, 0.2);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            word-break: break-word;
        }

        tr:hover {
            background: rgba(79, 180, 255, 0.1);
        }

        .rank {
            color: #4FB4FF;
            font-weight: bold;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin: 2rem 0;
            padding: 1rem;
            flex-wrap: wrap;
        }

        .pagination-btn {
            padding: 0.8rem 1.5rem;
            background: #2d3748;
            border: none;
            border-radius: 4px;
            color: #4FB4FF;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            touch-action: manipulation;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #4FB4FF;
            color: white;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            color: #718096;
        }

        .page-info {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            color: #4FB4FF;
            text-shadow: 0 0 10px rgba(79, 180, 255, 0.3);
        }

        /* Mobile Styles */
        @media (max-width: 600px) {
            .container {
                padding: 1rem;
            }
            
            .title-image {
                width: 100%;
            }
            
            .search-input {
                padding: 0.8rem;
                font-size: 0.7rem;
            }
            
            th, td {
                padding: 0.5rem;
                font-size: 0.7rem;
            }
            
            .pagination {
                gap: 1rem;
                margin: 1rem 0;
            }
            
            .pagination-btn {
                padding: 0.6rem 1rem;
                font-size: 0.7rem;
            }
            
            .page-info {
                font-size: 0.7rem;
            }
            
            .scoreboard {
                max-height: 500px;
            }
        }

        /* Small Mobile Styles */
        @media (max-width: 350px) {
            th, td {
                font-size: 0.6rem;
                padding: 0.4rem;
            }
            
            .pagination-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.6rem;
            }
            
            .page-info {
                font-size: 0.6rem;
            }
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    <div class="container">
        <div class="title">
            <img src="SatoshisSecret_Logo_Leaderboard.gif" alt="SATOSHI'S SECRET" class="title-image">
        </div>
        <div class="search-container">
            <input 
                type="text" 
                id="searchInput" 
                class="search-input" 
                placeholder="Search by name or wallet"
            >
        </div>
        <div class="scoreboard">
            <table id="scoreTable">
                <thead>
                    <tr>
                        <th>RANK</th>
                        <th>NAME</th>
                        <th>TIME</th>
                    </tr>
                </thead>
                <tbody id="scoreBody">
                    <!-- Scores will be inserted here by JavaScript -->
                </tbody>
            </table>
        </div>
        <div class="pagination">
            <button class="pagination-btn" id="prevPage" disabled>Previous</button>
            <span id="pageInfo" class="page-info">Page 1 of 23</span>
            <button class="pagination-btn" id="nextPage">Next</button>
        </div>
    </div>

    <script type="module">
        // Import Firebase functions
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AlzaSyBuLzLTA8pP4AbVtgyFiLfu-8E562EHjzg",
            authDomain: "satoshissecret-5a907.firebaseapp.com",
            projectId: "satoshissecret-5a907",
            storageBucket: "satoshissecret-5a907.appspot.com",
            messagingSenderId: "948378103018",
            appId: "1:948378103018:web:ee4b18e12cb0adc5427b93"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentPage = 1;
        const scoresPerPage = 25;
        let allScores = [];
        let filteredScores = [];

        function filterScores(searchTerm) {
            if (!searchTerm) {
                filteredScores = [...allScores];
            } else {
                searchTerm = searchTerm.toLowerCase();
                filteredScores = allScores.filter(score => 
                    score.Name.toLowerCase().includes(searchTerm) || 
                    score.Wallet?.toLowerCase().includes(searchTerm)
                );
            }
            currentPage = 1;
            updatePage(1);
            updatePaginationControls();
        }

        async function loadScores() {
            try {
                const querySnapshot = await getDocs(collection(db, 'WalletCollection'));
                allScores = [];
                
                querySnapshot.forEach((doc) => {
                    const scoreData = doc.data();
                    if (scoreData.Name && scoreData.Time) {
                        allScores.push({
                            Name: scoreData.Name,
                            Time: scoreData.Time,
                            Wallet: scoreData.Wallet
                        });
                    }
                });

                // Sort all scores
                allScores.sort((a, b) => {
                    // Convert times to seconds for comparison
                    const getSeconds = (time) => {
                        const parts = time.split(':').map(Number);
                        if (parts.length === 3) {
                            // HH:MM:SS format
                            const [hours, minutes, seconds] = parts;
                            return (hours * 3600) + (minutes * 60) + seconds;
                        } else {
                            // MM:SS format
                            const [minutes, seconds] = parts;
                            return (minutes * 60) + seconds;
                        }
                    };
                    
                    const aSeconds = getSeconds(a.Time);
                    const bSeconds = getSeconds(b.Time);
                    
                    return aSeconds - bSeconds;
                });

                filteredScores = [...allScores];
                updatePage(1);
                updatePaginationControls();
            } catch (error) {
                console.error('Error loading scores:', error);
                console.error('Error details:', error.message);
            }
        }

        function updatePage(pageNumber) {
            currentPage = pageNumber;
            const startIndex = (currentPage - 1) * scoresPerPage;
            const endIndex = startIndex + scoresPerPage;
            const pageScores = filteredScores.slice(startIndex, endIndex);

            const tableBody = document.getElementById('scoreBody');
            // Scroll the scoreboard back to top
            document.querySelector('.scoreboard').scrollTo({
                top: 0,
                behavior: 'smooth'
            });
            
            tableBody.innerHTML = '';
            
            pageScores.forEach((score, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="rank">#${startIndex + index + 1}</td>
                    <td>${score.Name}</td>
                    <td>${score.Time}</td>
                `;
                tableBody.appendChild(row);
            });

            updatePaginationControls();
        }

        function updatePaginationControls() {
            const totalPages = Math.ceil(filteredScores.length / scoresPerPage);
            const prevButton = document.getElementById('prevPage');
            const nextButton = document.getElementById('nextPage');
            const pageInfo = document.getElementById('pageInfo');

            prevButton.disabled = currentPage === 1;
            nextButton.disabled = currentPage === totalPages;
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
        }

        // Add event listeners for pagination buttons
        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage > 1) {
                updatePage(currentPage - 1);
            }
        });

        document.getElementById('nextPage').addEventListener('click', () => {
            const totalPages = Math.ceil(filteredScores.length / scoresPerPage);
            if (currentPage < totalPages) {
                updatePage(currentPage + 1);
            }
        });

        // Add event listener for search input
        document.getElementById('searchInput').addEventListener('input', (e) => {
            filterScores(e.target.value);
        });

        // Initial load
        loadScores();
    </script>
</body>
</html>
